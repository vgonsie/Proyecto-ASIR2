<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Herramienta de Pentesting</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
<div class="container">
    <header>
        <h1>Simulaci칩n de Ataques</h1>
        <div class="user-info">
            <span>Usuario: {{ username }} ({{ role }})</span>
            <a href="{{ url_for('logout') }}" class="logout-btn">Cerrar sesi칩n</a>
        </div>
    </header>

    {% if message %}
    <div class="message-box">{{ message }}</div>
    {% endif %}

    <form method="POST">
        <label for="ip">IP de destino:</label>
        <input type="text" id="ip" name="ip" placeholder="192.168.1.1" required>

        <label for="tipo_ataque">Tipo de ataque:</label>
        <select name="tipo_ataque" id="tipo_ataque" required>
            {% if role == 'admin' %}
                <option value="nmap">Escaneo Nmap (-sV)</option>
                <option value="hydra">Ataque Hydra</option>
                <option value="syn_flood">DoS SYN Flood</option>
                <option value="sniff">Sniffing Pasivo</option>
                <option value="ssh_ip_a">SSH + 'ip a'</option>
            {% else %}
                <option value="nmap">Escaneo Nmap (-sV)</option>
                <option value="ssh_ip_a">SSH + 'ip a'</option>
            {% endif %}
        </select>

        <!-- Campos espec칤ficos de Hydra -->
        <div id="hydra-fields" style="display:none;">
            <label for="diccionario">Diccionario:</label>
            <select name="diccionario" required>
                {% for d in diccionarios %}
                <option value="{{ d }}">{{ d }}</option>
                {% endfor %}
            </select>

            <label for="usuario">Usuario:</label>
            <input type="text" name="usuario" value="debian" required>

            <label for="protocolo">Protocolo:</label>
            <select name="protocolo" required>
                <option value="ssh">SSH</option>
                <option value="ftp">FTP</option>
                <option value="http">HTTP</option>
            </select>
        </div>

        <button type="submit" class="login-btn">Ejecutar Ataque</button>
    </form>

    <br>
    <a href="{{ url_for('dashboards') }}" class="dashboard-btn">游늵 Ver Dashboards</a>

    {% if result %}
    <div class="result-section">
        <h2>游댌 Resultado de Nmap</h2>
        {% if result.error %}
        <div class="error">{{ result.error }}</div>
        {% else %}
        <p><strong>Host:</strong> {{ result.host }}</p>
        <p><strong>Estado:</strong> {{ result.status }}</p>
        {% if result.mac %}<p><strong>MAC:</strong> {{ result.mac }}</p>{% endif %}
        {% if result.ports %}
        <table class="ports-table">
            <tr>
                <th>Puerto</th><th>Estado</th><th>Servicio</th><th>Versi칩n</th>
            </tr>
            {% for port in result.ports %}
            <tr>
                <td>{{ port.port }}</td>
                <td class="state-{{ port.state }}">{{ port.state }}</td>
                <td>{{ port.service }}</td>
                <td>{{ port.version }}</td>
            </tr>
            {% endfor %}
        </table>
        {% endif %}
        <pre class="raw-output">{{ result.raw_output }}</pre>
        {% endif %}
    </div>
    {% endif %}

    {% if hydra_result %}
    <div class="result-section">
        <h2>游댐 Resultado de Hydra</h2>
        {% if hydra_result.error %}
        <div class="error">{{ hydra_result.error }}</div>
        {% else %}
        <p><strong>Host:</strong> {{ hydra_result.host }}</p>
        <p><strong>Puerto:</strong> {{ hydra_result.port }}</p>
        <p><strong>Usuario:</strong> {{ hydra_result.login }}</p>
        <p><strong>Contrase침a:</strong> {{ hydra_result.password }}</p>
        <pre class="raw-output">{{ hydra_result.raw_output }}</pre>
        {% endif %}
    </div>
    {% endif %}
</div>

<script>
    const tipoAtaque = document.getElementById("tipo_ataque");
    const hydraFields = document.getElementById("hydra-fields");

    tipoAtaque.addEventListener("change", () => {
        hydraFields.style.display = tipoAtaque.value === "hydra" ? "block" : "none";
    });

    document.addEventListener("DOMContentLoaded", () => {
        hydraFields.style.display = tipoAtaque.value === "hydra" ? "block" : "none";
    });
</script>
</body>
</html>
