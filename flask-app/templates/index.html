<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Ataques</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîß Herramienta de Pentesting</h1>
            <div class="user-info">
                Usuario: <strong>{{ username }}</strong> |
                <a href="{{ url_for('logout') }}">Cerrar sesi√≥n</a>
            </div>
        </header>

        {% if message %}
            <div class="message-box">{{ message }}</div>
        {% endif %}

        <form method="POST">
            <label for="ip">IP de destino:</label>
            <input type="text" name="ip" required placeholder="192.168.1.100">

            <label for="tipo_ataque">Tipo de ataque:</label>
            <select name="tipo_ataque" required>
                <option value="nmap">Escaneo Nmap (-sV)</option>
                {% if role == 'admin' %}
                    <option value="hydra">Ataque Hydra</option>
                {% endif %}
            </select>

            {% if role == 'admin' %}
            <div id="hydra-fields">
                <label for="diccionario">Diccionario:</label>
                <select name="diccionario">
                    {% for d in diccionarios %}
                        <option value="{{ d }}">{{ d }}</option>
                    {% endfor %}
                </select>
                <label for="usuario">Usuario:</label>
                <input type="text" name="usuario" value="debian" required>
                <label for="protocolo">Protocolo:</label>
                <select name="protocolo">
                    <option value="ssh">SSH</option>
                    <option value="ftp">FTP</option>
                    <option value="http">HTTP</option>
                </select>
            </div>
            {% endif %}

            <button type="submit">Ejecutar</button>
        </form>

        {% if result %}
        <div class="result-section">
            <h2>üîç Resultados de Nmap</h2>
            {% if result.error %}
                <div class="error">{{ result.error }}</div>
            {% else %}
                <table class="info-table">
                    <tr><th>Host</th><td>{{ result.host }}</td></tr>
                    <tr><th>Estado</th><td>{{ result.status }}</td></tr>
                    {% if result.mac %}<tr><th>MAC</th><td>{{ result.mac }}</td></tr>{% endif %}
                </table>
                {% if result.ports %}
                    <h3>Puertos detectados:</h3>
                    <table class="ports-table">
                        <tr><th>Puerto</th><th>Estado</th><th>Servicio</th><th>Versi√≥n</th></tr>
                        {% for p in result.ports %}
                        <tr>
                            <td>{{ p.port }}</td>
                            <td class="state-{{ p.state }}">{{ p.state }}</td>
                            <td>{{ p.service }}</td>
                            <td>{{ p.version }}</td>
                        </tr>
                        {% endfor %}
                    </table>
                {% else %}
                    <p>No se encontraron puertos abiertos.</p>
                {% endif %}
                <pre class="raw-output">{{ result.raw_output }}</pre>
            {% endif %}
        </div>
        {% endif %}

        {% if hydra_result %}
        <div class="result-section">
            <h2>üîë Resultados de Hydra</h2>
            {% if hydra_result.error %}
                <div class="error">{{ hydra_result.error }}</div>
            {% else %}
                <table class="creds-table">
                    <tr><th>Host</th><td>{{ hydra_result.host }}</td></tr>
                    <tr><th>Puerto</th><td>{{ hydra_result.port }}</td></tr>
                    <tr><th>Usuario</th><td>{{ hydra_result.login }}</td></tr>
                    <tr><th>Contrase√±a</th><td>{{ hydra_result.password }}</td></tr>
                </table>
                <pre class="raw-output">{{ hydra_result.raw_output }}</pre>
            {% endif %}
        </div>
        {% endif %}
    </div>
</body>
</html>
