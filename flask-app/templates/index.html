<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Ataques - Proyecto ASIR2</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <header>
        <h1>üîí Panel de Simulaci√≥n de Ataques</h1>
        <div class="user-info">
            Sesi√≥n: <strong>{{ username }}</strong> |
            <a href="{{ url_for('logout') }}" class="btn-logout">‚èª Salir</a>
        </div>
    </header>

    <main>
        <form method="POST" class="attack-form">
            <label>IP Objetivo:</label>
            <input type="text" name="ip" required>

            <label>Tipo de ataque:</label>
            <select name="tipo_ataque" required id="tipo_ataque_select">
                <option value="nmap">Escaneo Nmap</option>
                <option value="hydra">Fuerza Bruta (Hydra)</option>
                <option value="syn_flood">SYN Flood</option>
                <option value="sniff">Sniffing de Red</option>
                <option value="ssh_ip">Escaneo interfaz de red (SSH)</option>
            </select>

            <div id="hydra-options" class="conditional-options" style="display:none;">
                <label>Usuario:</label>
                <input type="text" name="usuario" value="debian">
                <label>Protocolo:</label>
                <select name="protocolo">
                    <option value="ssh">SSH</option>
                    <option value="ftp">FTP</option>
                </select>
                <label>Diccionario:</label>
                <select name="diccionario">
                    {% for dic in diccionarios %}
                        <option value="{{ dic }}">{{ dic }}</option>
                    {% endfor %}
                </select>
            </div>

            <div id="flood-options" class="conditional-options" style="display:none;">
                <label>Puerto:</label>
                <input type="number" name="puerto" value="80">
                <label>Duraci√≥n (s):</label>
                <input type="number" name="duracion" value="10">
            </div>

            <div id="sniff-options" class="conditional-options" style="display:none;">
                <label>Interfaz:</label>
                <input type="text" name="interfaz" value="eth0">
                <label>Duraci√≥n (s):</label>
                <input type="number" name="duracion" value="10">
            </div>

            <div id="ssh-options" class="conditional-options" style="display:none;">
                <label>Usuario SSH:</label>
                <input type="text" name="ssh_user" value="debian">
                <label>Contrase√±a SSH:</label>
                <input type="password" name="ssh_pass">
            </div>

            <button type="submit">üöÄ Ejecutar Ataque</button>
        </form>

        {% if message %}
            <div class="message">{{ message }}</div>
        {% endif %}

        {% if result %}
            <div class="output-box">
                <h3>Resultados de Nmap</h3>
                <pre>
Host: {{ result.host }}
Estado: {{ result.status }}
MAC: {{ result.mac }}

{% for p in result.ports %}
- {{ p.port }} | {{ p.service }} | {{ p.version }}
{% endfor %}
                </pre>
            </div>
        {% endif %}

        {% if hydra_result %}
            <div class="output-box">
                <h3>Resultados de Hydra</h3>
                {% if hydra_result.error %}
                    <pre>{{ hydra_result.error }}</pre>
                {% else %}
                    <pre>
Host: {{ hydra_result.host }}
Puerto: {{ hydra_result.port }}
Usuario: {{ hydra_result.login }}
Contrase√±a: {{ hydra_result.password }}
                    </pre>
                {% endif %}
            </div>
        {% endif %}

        {% if ssh_result %}
            <div class="output-box">
                <h3>Resultado del Escaneo de Interfaz</h3>
                <pre>{{ ssh_result }}</pre>
            </div>
        {% endif %}

        {% if sniff_results %}
            <div class="output-box">
                <h3>Resultados del Sniffing</h3>
                {% if sniff_results|length == 0 %}
                    <p>No se capturaron paquetes durante el sniffing.</p>
                {% else %}
                    <table>
                        <thead>
                            <tr>
                                <th>Origen</th>
                                <th>Destino</th>
                                <th>Protocolo</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for pkt in sniff_results %}
                                <tr>
                                    <td>{{ pkt.src }}</td>
                                    <td>{{ pkt.dst }}</td>
                                    <td>{{ pkt.proto }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% endif %}
            </div>
        {% endif %}
    </main>

    <footer>
        <a href="{{ url_for('dashboards') }}" class="dashboards-btn">üìä Ver Dashboards</a>
    </footer>

    <script>
        const tipoSelect = document.getElementById('tipo_ataque_select');

        const options = {
            hydra: document.getElementById('hydra-options'),
            syn_flood: document.getElementById('flood-options'),
            sniff: document.getElementById('sniff-options'),
            ssh_ip: document.getElementById('ssh-options')
        };

        function updateForm() {
            for (const key in options) {
                options[key].style.display = 'none';
            }
            let selected = tipoSelect.value;
            if (options[selected]) {
                options[selected].style.display = 'block';
            }
        }

        updateForm();
        tipoSelect.addEventListener('change', updateForm);
    </script>
</body>
</html>
