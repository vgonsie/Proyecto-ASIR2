<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‚ö° Pentest Tool</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>
<body>
  <div class="wrapper">
    <header>
      <h1>‚ö° Pentest Tool</h1>
      <div class="user-bar">
        <span>Usuario: {{ username }}</span>
        <a href="{{ url_for('logout') }}">üîí Cerrar sesi√≥n</a>
      </div>
    </header>

    {% if message %}
      <div class="alert success">{{ message }}</div>
    {% endif %}

    <form method="POST" class="attack-form">
      <div class="field">
        <label for="ip">IP de destino:</label>
        <input type="text" id="ip" name="ip" placeholder="192.168.1.1" required />
      </div>

      <div class="field">
        <label for="tipo_ataque">Tipo de ataque:</label>
        <select id="tipo_ataque" name="tipo_ataque" required>
          <option value="nmap">üîç Escaneo Nmap</option>
          <option value="hydra">üîë Ataque Hydra</option>
          <option value="syn_flood">üí• SYN Flood</option>
          <option value="sniff">üì° Sniffing Pasivo</option>
          <option value="ssh_ip_a">üîê SSH + ip a</option>
        </select>
      </div>

      <div class="field hidden" id="puerto-syn">
        <label for="puerto">Puerto:</label>
        <select name="puerto">
          <option>22</option><option>80</option><option>443</option>
          <option>21</option><option>25</option><option>53</option>
        </select>
      </div>

      <div class="field hidden" id="duracion-fields">
        <label for="duracion">Duraci√≥n (s):</label>
        <input type="number" name="duracion" value="10" min="5" max="300"/>
      </div>

      <div class="field hidden" id="hydra-fields">
        <label for="diccionario">Diccionario:</label>
        <select name="diccionario">
          {% for d in diccionarios %}
            <option>{{ d }}</option>
          {% endfor %}
        </select>
        <label for="usuario">Usuario:</label>
        <input type="text" name="usuario" value="debian" />
        <label for="protocolo">Protocolo:</label>
        <select name="protocolo">
          <option>ssh</option><option>ftp</option><option>http</option>
        </select>
      </div>

      <div class="field hidden" id="sniff-fields">
        <label for="interfaz">Interfaz:</label>
        <select name="interfaz">
          {% for iface in interfaz_list %}
            <option {% if iface==interfaz_predicha %}selected{% endif %}>{{ iface }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="field hidden" id="ssh-ipa-fields">
        <label for="ssh_usuario">SSH Usuario:</label>
        <input type="text" name="ssh_usuario" value="root" />
        <label for="ssh_contrasena">SSH Contrase√±a:</label>
        <input type="password" name="ssh_contrasena" />
      </div>

      <button type="submit" class="btn execute">‚ñ∂ Ejecutar</button>
    </form>

    <section class="results">

      {% if result %}
      <div class="card">
        <h2>üîç Resultados Nmap</h2>
        {% if result.error %}
          <pre class="error">{{ result.error }}</pre>
        {% else %}
          <table>
            <tr><th>Host</th><td>{{ result.host }}</td></tr>
            <tr><th>Estado</th><td>{{ result.status }}</td></tr>
            {% if result.mac %}<tr><th>MAC</th><td>{{ result.mac }}</td></tr>{% endif %}
          </table>
          {% if result.ports %}
          <h3>Puertos Abiertos</h3>
          <table class="ports">
            <tr><th>Puerto</th><th>Estado</th><th>Svc</th><th>Versi√≥n</th></tr>
            {% for p in result.ports %}
              <tr>
                <td>{{ p.port }}</td>
                <td class="state-{{ p.state }}">{{ p.state }}</td>
                <td>{{ p.service }}</td>
                <td>{{ p.version }}</td>
              </tr>
            {% endfor %}
          </table>
          {% endif %}
        {% endif %}
      </div>
      {% endif %}

      {% if hydra_result %}
      <div class="card">
        <h2>üîë Resultados Hydra</h2>
        {% if hydra_result.error %}
          <pre class="error">{{ hydra_result.error }}</pre>
        {% else %}
          <table>
            <tr><th>Host</th><td>{{ hydra_result.host }}</td></tr>
            <tr><th>Puerto</th><td>{{ hydra_result.port }}</td></tr>
            <tr><th>Usuario</th><td>{{ hydra_result.login }}</td></tr>
            <tr><th>Pass</th><td class="password">{{ hydra_result.password }}</td></tr>
          </table>
        {% endif %}
      </div>
      {% endif %}

      {% if sniff_result %}
      <div class="card">
        <h2>üì° Tr√°fico Capturado</h2>
        <p>IPs vistas: {{ sniff_result.total_ips }}</p>
        <p>Protocolos: {{ sniff_result.protocolos|join(', ') }}</p>
        <p>Lista IPs: {{ sniff_result.ips_vistas|join(', ') }}</p>
      </div>
      {% endif %}

      {% if ssh_ipa_result %}
      <div class="card">
        <h2>üîê SSH ‚ûî ip a</h2>
        {% if not ssh_ipa_result.success %}
          <pre class="error">{{ ssh_ipa_result.error }}</pre>
        {% else %}
          <pre class="raw">{{ ssh_ipa_result.output }}</pre>
        {% endif %}
      </div>
      {% endif %}

    </section>
  </div>

  <script>
    const sel = document.getElementById('tipo_ataque');
    const toggle = (id, show) => document.getElementById(id).classList.toggle('hidden', !show);

    sel.addEventListener('change', () => {
      const v = sel.value;
      toggle('puerto-syn',     v==='syn_flood');
      toggle('duracion-fields', ['syn_flood','sniff'].includes(v));
      toggle('hydra-fields',    v==='hydra');
      toggle('sniff-fields',    v==='sniff');
      toggle('ssh-ipa-fields',  v==='ssh_ip_a');
    });

    // Al cargar, oculta/mostrar seg√∫n valor por defecto
    sel.dispatchEvent(new Event('change'));
  </script>
</body>
</html>
