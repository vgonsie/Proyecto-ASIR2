<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Herramienta de Pentesting</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Simulación de Ataques</h1>
            <div class="user-info">
                <span>Usuario: {{ username }}</span>
                <a href="{{ url_for('logout') }}" class="logout-btn">Cerrar sesión</a>
            </div>
        </header>

        {% if message %}
        <div class="message-box">{{ message }}</div>
        {% endif %}

        <!-- Formulario -->
        <form method="POST">
            <label for="ip">IP de destino:</label>
            <input type="text" id="ip" name="ip" placeholder="192.168.1.1" required>

            <div class="form-section">
                <label for="tipo_ataque">Tipo de ataque:</label>
                <select name="tipo_ataque" id="tipo_ataque" required>
                    <option value="nmap">Escaneo Nmap (-sV)</option>
                    <option value="hydra">Ataque Hydra</option>
                    <option value="syn_flood">DoS SYN Flood</option>
                </select>
            </div>

            <!-- Puerto objetivo -->
            <div class="form-section" id="puerto-syn" style="display:none;">
                <label for="puerto">Puerto objetivo:</label>
                <select name="puerto" required>
                    <option value="80">80 (HTTP)</option>
                    <option value="443">443 (HTTPS)</option>
                    <option value="22">22 (SSH)</option>
                    <option value="21">21 (FTP)</option>
                    <option value="25">25 (SMTP)</option>
                    <option value="53">53 (DNS)</option>
                </select>
            </div>

            <!-- Campos específicos de Hydra -->
            <div class="form-section" id="hydra-fields" style="display:none;">
                <label for="diccionario">Diccionario:</label>
                <select name="diccionario" required>
                    {% for diccionario in diccionarios %}
                        <option value="{{ diccionario }}">{{ diccionario }}</option>
                    {% endfor %}
                </select>

                <label for="usuario">Usuario:</label>
                <input type="text" name="usuario" value="debian" required>

                <label for="protocolo">Protocolo:</label>
                <select name="protocolo" required>
                    <option value="ssh">SSH</option>
                    <option value="ftp">FTP</option>
                    <option value="http">HTTP</option>
                </select>
            </div>

            <!-- Botón ejecutar -->
            <button type="submit" class="login-btn">Ejecutar Ataque</button>
        </form>

        <!-- Resultado del SYN Flood -->
        {% if syn_attack %}
        <div class="result-section hydra-results">
            <h2>🧱 Detalles del Ataque SYN Flood</h2>
            <table class="creds-table">
                <tr><th>IP objetivo:</th><td>{{ syn_attack.ip }}</td></tr>
                <tr><th>Puerto:</th><td>{{ syn_attack.puerto }}</td></tr>
                <tr><th>Tipo de ataque:</th><td>{{ syn_attack.tipo }}</td></tr>
                <tr><th>Fecha:</th><td>{{ syn_attack.fecha }}</td></tr>
            </table>
        </div>
        {% endif %}

        <!-- Resultado del escaneo Nmap -->
        {% if result %}
        <div class="result-section nmap-results">
            <h2>🔍 Escaneo Nmap</h2>
            {% if result.error %}
                <div class="error">{{ result.error | e }}</div>
            {% else %}
                <table class="info-table">
                    <tr><th>Host:</th><td>{{ result.host | e }}</td></tr>
                    <tr><th>Estado:</th><td>{{ result.status | e }}</td></tr>
                    {% if result.mac %}<tr><th>MAC:</th><td>{{ result.mac | e }}</td></tr>{% endif %}
                </table>

                {% if result.ports %}
                    <h3>📌 Puertos abiertos</h3>
                    <table class="ports-table">
                        <tr>
                            <th>Puerto</th>
                            <th>Estado</th>
                            <th>Servicio</th>
                            <th>Versión</th>
                        </tr>
                        {% for port in result.ports %}
                        <tr>
                            <td>{{ port.port }}</td>
                            <td class="state-{{ port.state }}">{{ port.state }}</td>
                            <td>{{ port.service }}</td>
                            <td>{{ port.version }}</td>
                        </tr>
                        {% endfor %}
                    </table>
                {% else %}
                    <p class="no-ports">No se encontraron puertos abiertos</p>
                {% endif %}
            {% endif %}
            <button onclick="toggleRaw('nmap-raw')" class="toggle-btn">Mostrar/Ocultar output completo</button>
            <pre id="nmap-raw" class="raw-output">{{ result.raw_output | e }}</pre>
        </div>
        {% endif %}

        <!-- Resultado del ataque Hydra -->
        {% if hydra_result %}
        <div class="result-section hydra-results">
            <h2>🔑 Resultados de Hydra</h2>
            {% if hydra_result.error %}
                <div class="error">{{ hydra_result.error | e }}</div>
            {% else %}
                <table class="creds-table">
                    <tr><th>IP objetivo:</th><td>{{ hydra_result.host }}</td></tr>
                    <tr><th>Diccionario:</th><td>{{ request.form.diccionario }}</td></tr>
                    <tr><th>Usuario:</th><td>{{ hydra_result.login }}</td></tr>
                    <tr><th>Contraseña:</th><td class="password">{{ hydra_result.password }}</td></tr>
                </table>
            {% endif %}
            <button onclick="toggleRaw('hydra-raw')" class="toggle-btn">Mostrar/Ocultar output completo</button>
            <pre id="hydra-raw" class="raw-output">{{ hydra_result.raw_output }}</pre>
        </div>
        {% endif %}
    </div>

    <!-- Script para mostrar campos según tipo de ataque -->
    <script>
        const tipoAtaque = document.getElementById("tipo_ataque");
        const hydraFields = document.getElementById("hydra-fields");
        const puertoSyn = document.getElementById("puerto-syn");

        tipoAtaque.addEventListener("change", () => {
            const valor = tipoAtaque.value;
            hydraFields.style.display = (valor === "hydra") ? "block" : "none";
            puertoSyn.style.display = (valor === "syn_flood") ? "block" : "none";
        });

        function toggleRaw(id) {
            const element = document.getElementById(id);
            element.style.display = element.style.display === 'none' ? 'block' : 'none';
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('nmap-raw').style.display = 'none';
            document.getElementById('hydra-raw').style.display = 'none';
        });
    </script>
</body>
</html>
