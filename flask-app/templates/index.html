<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Herramienta de Pentesting</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Simulaci√≥n de Ataques</h1>
            <div class="user-info">
                <span>Usuario: {{ username }}</span>
                <a href="{{ url_for('logout') }}" class="logout-btn">Cerrar sesi√≥n</a>
            </div>
        </header>

        <form method="POST">
            <label for="ip">IP de destino:</label>
            <input type="text" id="ip" name="ip" placeholder="192.168.1.1" required>

            <div class="form-section">
                <label for="diccionario">Diccionario:</label>
                <select name="diccionario" required>
                    {% for diccionario in diccionarios %}
                        <option value="{{ diccionario }}">{{ diccionario }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-section">
                <label for="usuario">Usuario:</label>
                <input type="text" id="usuario" name="usuario" value="debian" required>
            </div>

            <div class="form-section">
                <label for="protocolo">Protocolo:</label>
                <select name="protocolo" required>
                    <option value="ssh">SSH</option>
                    <option value="ftp">FTP</option>
                    <option value="http">HTTP</option>
                </select>
            </div>

            <div class="buttons">
                <button type="submit" name="hydra" class="hydra-btn">Ejecutar Hydra</button>
                <button type="submit" name="nmap" class="nmap-btn">Ejecutar Nmap</button>
            </div>
        </form>

        <div class="results">
            {% if result %}
                <div class="result-section nmap-results">
                    <h2>üîç Resultados de Nmap</h2>
                    {% if result.error %}
                        <div class="error">{{ result.error | e }}</div>
                    {% else %}
                        <table class="info-table">
                            <tr><th>Host:</th><td>{{ result.host | e }}</td></tr>
                            <tr><th>Estado:</th><td>{{ result.status | e }}</td></tr>
                            {% if result.mac %}<tr><th>MAC:</th><td>{{ result.mac | e }}</td></tr>{% endif %}
                        </table>

                        {% if result.ports %}
                            <h3>üìå Puertos abiertos</h3>
                            <table class="ports-table">
                                <tr>
                                    <th>Puerto</th>
                                    <th>Estado</th>
                                    <th>Servicio</th>
                                    <th>Versi√≥n</th>
                                </tr>
                                {% for port in result.ports %}
                                <tr>
                                    <td>{{ port.port | e }}</td>
                                    <td class="state-{{ port.state }}">{{ port.state | e }}</td>
                                    <td>{{ port.service | e }}</td>
                                    <td>{{ port.version | e }}</td>
                                </tr>
                                {% endfor %}
                            </table>
                        {% else %}
                            <p class="no-ports">No se encontraron puertos abiertos</p>
                        {% endif %}
                    {% endif %}
                    <button onclick="toggleRaw('nmap-raw')" class="toggle-btn">Mostrar/Ocultar output completo</button>
                    <pre id="nmap-raw" class="raw-output">{{ result.raw_output | e }}</pre>
                </div>
            {% endif %}

            {% if hydra_result %}
                <div class="result-section hydra-results">
                    <h2>üîë Resultados de Hydra</h2>
                    {% if hydra_result.error %}
                        <div class="error">{{ hydra_result.error | e }}</div>
                    {% else %}
                        <table class="creds-table">
                            <tr><th>Host:</th><td>{{ hydra_result.host | e }}</td></tr>
                            <tr><th>Puerto:</th><td>{{ hydra_result.port | e }}</td></tr>
                            <tr><th>Usuario:</th><td>{{ hydra_result.login | e }}</td></tr>
                            <tr><th>Contrase√±a:</th><td class="password">{{ hydra_result.password | e }}</td></tr>
                        </table>
                    {% endif %}
                    <button onclick="toggleRaw('hydra-raw')" class="toggle-btn">Mostrar/Ocultar output completo</button>
                    <pre id="hydra-raw" class="raw-output">{{ hydra_result.raw_output | e }}</pre>
                </div>
            {% endif %}
        </div>
    </div>

    <script>
        function toggleRaw(id) {
            const element = document.getElementById(id);
            element.style.display = element.style.display === 'none' ? 'block' : 'none';
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('nmap-raw').style.display = 'none';
            document.getElementById('hydra-raw').style.display = 'none';
        });
    </script>
</body>
</html>
